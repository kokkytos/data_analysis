---
title: "Έλεγχος υποθέσεων του μέσου αριθμητικού"
output:
  html_document:
    df_print: paged
---

Στην τρέχουσα ενότητα/άσκηση ασχολούμαστε με το ερώτημα, αν ο μέσος ενός κανονικού πληθυσμού
διαφέρει από μια προκαθορισμένη τιμή.
Αν είναι γνωστή ή όχι η διακύμανση της κατανομής του πληθυσμού θα καθορίσει και το είδος του τεστ (z-test ή t-test)
Οι βασικές υποθέσεις που γίνονται είναι ότι
- τα δεδομένα μετριούνται σε κλίμακα διαστήματος ή λόγου.
- δείγμα είναι τυχαίο από μια κανονική κατανομή.
- η τυπική απόκλιση (σ) της κατανομή είναι γνωστή.


# Πρόβλημα
Κατά τα τελευταία τρία χρόνια σε μια περιφέρεια αναφέρεται ότι τα περιστατικά των ατυχημάτων φορτηγών 
είναι 0.8 συγκρούσεων ανά 1 εκατ. οχηματοχιλιόμετρα και με τυπική απόκλιση 0.4
Στα πλαίσια του περιορισμού αυτών των ατυχημάτων επιβλήθηκε στους οδηγούς φορτηγών να παρακολουθήσουν
συμπληρωματικά ένα πρόγραμμα μαθήματων οδήγησης για την ασφαλειά τους.
Μετά το πέρας του προγράμματος μετρήθηκαν δειγματοληπτικά σε 50 τμήματα του οδικού δικτύου ο αριθμός των συγκρούσεων.
Ζητείται να διαπιστωθεί κατά πόσο το πρόγραμμα αυτό συνέβαλε στον περιορισμό των συγκρούσεων.

Παρακάτω δίνεται ο αριθμός των συγκρούσεων/εκατ.vkm
```{r}
df <- c(0.3, 0.91, 0.69, 0.57, 0.28, 0.86, 0.68, 0.36, 0.83, 0.88, 
0.76, 0.85, 1.05, 0.7, 0.83, 0.76, 0.51, 0.6, 0.8, 0.71, 1.24, 
1.09, 0.23, 0.67, 0.97, 0.97, 0.37, 0.31, 0.76, 0.63, 0.91, 0.97, 
0.4, 0.59, 1.05, 0.57, 0.12, 0.69, 0.86, 0.7, 0.6, 0.69, 0.51, 
0.72, 1.27, 0.82, 0.43, 0.86, 0.32, 0.83)

df <- data.frame(df)
colnames(df) <- "CrashRate"
df
```
Ας δούμε την κατανομή των δεδομένων:

```{r}
hist(df$CrashRate)
plot(density(df$CrashRate)) # plots the results
```
Η κατανομή προσομοιάζει το σχήμα καμπάνας (κανονική κατανομή).
Από τα δεδομένα έχουμε:

```{r}
mean_pop <- 0.8 # μέσο όρο πληθυσμού
sd_pop <- 0.4 #τυπική απόκλιση πληθυσμού
mean_sample <- mean(df$CrashRate) # 0.7016
sd_sample <-sd(df$CrashRate) # 0.2579619
n <- length(df$CrashRate) # 50
```
Αρχικά η πρώτη διαπίστωση που θα μπορούσε να κάνει κάποιος είναι ότι το πρόγραμμα μειώνει τα περιστατικά 
συγκρούσεων (μιας και έχει mean 0.7016 έναντι 0.8).
Ωστόσο μια τέτοια διαπίστωση είναι βεβιασμένη γιατί ο μέσος όρος για το πρόγραμμα προέκυψε από δειγματοληψία γεγονός που δεν αντιπροσωπέυει πλήρως την πραγματική εικόνα του πληθυσμού καθότι περιέχει μέσα το δειγματοληπτικό σφάλμα. Άρα μπορεί το αποτέλεσμα της μείωσης που φαίνεται στο δείγμα να είναι απλά τυχαίο γεγονός και όχι μια ακραία συνθήκη που οδηγεί στην απόρριψη της μηδενικής υπόθεσης.
Οπότε ο αναλυτής προσφεύγει στην ανάλυση υποθέσεων για να διαπιστώσει την επίπτωση του προγράμματος στον ρυθμό συγκρούσεων.

Βήμα 1.
Η διατύπωση των υποθέσεων είναι ως εξής:
Ho: μ >= 0.8, μηδενική υπόθεση. Ότι ο ρυθμός των ατυχημάτων μετά το εκπαιδευτικό πρόγραμμα δεν διαφέρει από τον μέσο όρο 0.8 που ίσχυει γενικά για τα ατυχήματα τα τελευταία τρια χρόνια.
HA: μ < 0.8 εναλλακτική υπόθεση. Ο ρυθμός των ατυχημάτων μετά το εκπαιδευτικό πρόγραμμα είναι μικρότερος από τον μέσο όρο 0.8 που ίσχυει γενικά για τα ατυχήματα τα τελευταία τρια χρόνια.

Ό έλεγχος είναι μονόπλευρος δεδομένου ότι ελέγχουμε ότι οι συγκρούσεις μειώθηκαν όπως μας λέει το δείγμα.

Βήμα 2.
Ο έλεγχος υποθέσεων θα γίνει στο Επίπεδο σημαντικότητας 5%:
α=0.05.
```{r}
alpha <- 0.05
```
Υπολογίζουμε τα όρια της περιοχής αποδοχής και απόρριψης (Z critical) για α=0.05
```{r}
Z.critical <- qnorm(1-alpha)

Z.critical
```
Οποιαδήποτε τιμή πέρα από τα όρια ± 1.645 θεωρείται σπάνιο γεγονός και οδηγεί στην απόρριψη της μηδενικής υπόθεσης H0.



Βήμα 3.
Υπολογίζουμε την τιμή του στατιστικού τεστ.
```{r}
z_obtained<-(mean_sample-mean_pop)/(sd_pop/sqrt(n))
z_obtained
```

```{r}
area_poly <- function(cur, cutoff, side=c(1,-1), col = "grey", border=NA, ...)
{
  if (side[1]>0 )# on the right
  {
    pos <- min(which(cur$x > cutoff))
    end <- length(cur$x)
  }
  else # on the left
  {
    pos <- max(which(cur$x < cutoff))
    end <- 1
  }
  polygon(x=c(cur$x[end:pos], cur$x[pos], cur$x[end]),
          y=c(cur$y[end:pos], 0, 0), col=col, border=border, ...)
}

cc <- curve(dnorm(x, mean = 0, sd = 1), from = -3, to = 3, n = 100, lwd = 3,
            xlab = "Z", ylab = "Density", frame = F)
area_poly(cc, cutoff =-Z.critical, side = 0, col = "blue", density = 20)

abline(v = -Z.critical,  lwd=3)

abline(v = z_obtained, col = "red", lwd=2, lty=2)
text(-2.2,0.05,"a=5%",     cex = 0.88, pos = 2, col = "blue")
mtext("Περιοχή μη απόρριψης Ho",side = 1,line = - 2)

text(-2,0.2,"Περιοχή \nαπόρριψης Ηο",     cex = 0.88, pos = 2, col = "blue")

```



Συμπέρασμα:
Η μηδενική υπόθεση Ho απορρίπτεται στο επίπεδο σημαντικότητας α=0.05 δεδομένου ότι το z_obtained<z_critical.
Οπότε απορρίπτεται η εικασία ότι ο ρυθμός των ατυχημάτων μετά το εκπαιδευτικό πρόγραμμα δεν μειώθηκε σε σχέση με τον μέσο όρο 0.8 που ίσχυει γενικά για τα ατυχήματα τα τελευταία τρια χρόνια. Άρα αυτό σημαίνει ότι κατόπιν της εφαρμογής του προγράμματος υπήρχε επίπτωση στον αριθμό των συγκρούσεων.
Όμως ο παραπάνω έλεγχος υποθέσεων ελέγχει αν υπάρχει μείωση.

Τι αποτέλεσμα θα έφερε ένας δίπλευρος έλεγχος όπου στη εναλλακτική υπόθεση θα ελέγχοταν αν το πρόγραμμα επέφερε γενικά μεταβολή στον ρυθμό ατυχημάτων.
Για να απαντηθεί το ερώτημα αν υπήρχε μεταβολή στις συγκρούσεις κατόπιν της εφαρμογής του προγράμματος πρέπει να γίνει δίπλευρος έλεγχος με υποθέσεις εργασίας:
Ho: μ = 0.8,
HΑ: μ ≠ 0.8

Σε αυτήν την περίπτωση προσέχουμε ότι το όριο της περιοχής απόρριψης ορίζεται δίπλευρα και είναι πιο κοντά στον μέσο όρο δηλ. 1.64 βλέπε υπολογισμό παρακάτω


```{r}
Z.critical <- qnorm(1-alpha/2)
Z.critical
```

Πως ερμηνεύετε το αποτέλεσμα αναφορικά με την έλεγχο υποθέσεων σε διάστημα εμπιστοσύνης α=5%:
Ho: μ = 0.8,
HΑ: μ ≠ 0.8


```{r}

cc <- curve(dnorm(x, mean = 0, sd = 1), from = -3, to = 3, n = 100, lwd = 3,
            xlab = "Z", ylab = "Density", frame = F)
area_poly(cc, cutoff =-Z.critical, side = 0, col = "blue", density = 20)
area_poly(cc, cutoff =Z.critical, side = 2, col = "blue", density = 20)
abline(v = -Z.critical,  lwd=3)
abline(v = Z.critical,  lwd=3)
abline(v = z_obtained, col = "red", lwd=2, lty=2)
mtext("Περιοχή μη απόρριψης Ho",side = 1,line = - 2)
text(-2.2,0.05,"a=2.5%",     cex = 0.88, pos = 2, col = "blue")
text(2.85,0.05,"a=2.5%",     cex = 0.88, pos = 2, col = "blue")
text(-2,0.2,"Περιοχή \nαπόρριψης Ηο",     cex = 0.88, pos = 2, col = "blue")
```


